name: Linting and Testing
on: push
env:
  DATABASE_URL: sqlite
  SECRET_KEY: 1
  MODE_DEBUG: 1
jobs:
 lint:
   runs-on: ubuntu-latest
   steps:
     - name: Checkout
       uses: actions/checkout@v3

     - name: Install Poetry
       uses: snok/install-poetry@v1

     - uses: actions/setup-python@v3
       with:
        python-version: 3.10.8

     - name: install dependencies
       run: poetry install

     - name: run linting
       run: poetry run flake8
 test:
   needs: [lint]
   runs-on: ubuntu-latest
   steps:
     - name: Checkout
       uses: actions/checkout@v3

     - name: Install Poetry
       uses: snok/install-poetry@v1

     - uses: actions/setup-python@v3
       with:
         python-version: 3.10.8

     - name: install dependencies
       run: poetry install
     - name: start server
       run: poetry run python3 manage.py runserver
       working-directory: moviereviews/

     - name: testing
       run: poetry run pytest

